---
title: "Income Tax Data Project"
author: "Noushin Nabavi"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  pdf_document: default
  html_document: default
---

# Introduction 
The income estimates for individuals range from years 2000 up to 2016. Each table in a year is an aggregation of all sub-tables as listed in Table 1.
The income estimates for families range from years 2004 up to 2016. Each table in a year is an aggregation of all sub-tables as listed in Table 2. The technical Reference Guide for the Annual Income Estimates for Census Families, Individuals and Seniors can be found as the file names STATSCAN_METADATA_2016. For information about this product or the wide range of services and data available from Statistics Canada, visit their [website](www.statcan.gc.ca).
You can also contact Statistics Canada by emailing STATCAN.infostats-infostats.STATCAN@canada.ca.


# Software Dependencies

The library dependencies in RStudio includes: 
```{r eval=FALSE}
library(data.table)
library(openxlsx)
library(dplyr)
library(stringr)
```


# BC Extraction from Federal Geography

The work done on these files includes extracting Canada, provinces, and British Columbia's postal areas from the Canada-wide data. This was achieved by using the following filter for all files:
```{r eval=FALSE}
dat1.new <- subset(dat1[dat1$Geo_Level == "11" | dat1$Geo_Level == "12",])
dat2.new <- subset(dat1[dat1$Place_Name == "ABBOTSFORD - MISSION" | 
                          dat1$Place_Name == "CHILLIWACK" | 
                          dat1$Place_Name == "KAMLOOPS" | 
                          dat1$Place_Name == "KELOWNA" | 
                          dat1$Place_Name == "PRINCE GEORGE" | 
                          dat1$Place_Name == "VANCOUVER" | 
                          dat1$Place_Name == "VICTORIA"| 
                          dat1$Place_Name ==  "VANCOUVER ISLAND AND COAST" | 
                          dat1$Place_Name =="VANCOUVER CENTRE" | 
                          dat1$Place_Name == "VANCOUVER EAST" | 
                          dat1$Place_Name == "VANCOUVER GRANVILLE" | 
                          dat1$Place_Name == "VANCOUVER KINGSWAY" | 
                          dat1$Place_Name ==  "VANCOUVER QUADRA" | 
                          dat1$Place_Name == "VANCOUVER SOUTH", ])
dat3.new <-subset(dat1, grepl("^V", Postal_Area))
dat4.new <-subset(dat1, grepl("^9", Postal_Area))
df <- rbind(dat1.new, dat2.new, dat3.new, dat4.new)
```


# File structures for census income estimates Are Broken into Individuals and Families  

```{r echo=FALSE}
setwd("~/Desktop/Income_Project")
getwd()
dir.wrk1 <- "~/Desktop/Income_Project"
dir.wrk1 <- getwd()
```

```{r echo=FALSE}
list.files(dir.wrk1)
```


# Table structures and merges per year

```{r echo=TRUE, eval=FALSE}

df1 <- read.table(file ="2015_Individuals_Table_1_Canada.csv", sep = ",")
df2 <- read.table(file ="2015_Individuals_Table_2_Canada.csv", sep = ",")
df3 <- read.table(file ="2015_Individuals_Table_3A_Canada.csv", sep = ",")
df4 <- read.table(file ="2015_Individuals_Table_3B_Canada.csv", sep = ",")
df5 <- read.table(file ="2015_Individuals_Table_3C_Canada.csv", sep = ",")
df6 <- read.table(file ="2015_Individuals_Table_4_Canada.csv", sep = ",")
df7 <- read.table(file ="2015_Individuals_Table_5A_Canada.csv", sep = ",")
df8 <- read.table(file ="2015_Individuals_Table_5B_Canada.csv", sep = ",")
df9 <- read.table(file ="2015_Individuals_Table_5C_Canada.csv", sep = ",")
df10 <- read.table(file ="2015_Individuals_Table_6_Canada.csv", sep = ",")
df11 <- read.table(file ="2015_Individuals_Table_7A_Canada.csv", sep = ",")
df12 <- read.table(file ="2015_Individuals_Table_7B_Canada.csv", sep = ",")
df13 <- read.table(file ="2015_Individuals_Table_7C_Canada.csv", sep = ",")
df14 <- read.table(file ="2015_Individuals_Table_8_Canada.csv", sep = ",")
df15 <- read.table(file ="2015_Individuals_Table_9_Canada.csv", sep = ",")
df16 <- read.table(file ="2015_Individuals_Table_10_Canada.csv", sep = ",")
df17 <- read.table(file ="2015_Individuals_Table_11_Canada.csv", sep = ",")
df18 <- read.table(file ="2015_Individuals_Table_12_Canada.csv", sep = ",")
df19 <- read.table(file ="2015_Individuals_Table_13_Canada.csv", sep = ",")


DFs <- data.frame(cbind(df1, df2[,6:ncol(df2)],df3[,6:ncol(df3)], df4[,6:ncol(df4)], df5[,6:ncol(df5)], df6[,6:ncol(df6)], df7[,6:ncol(df7)], df8[,6:ncol(df8)], df9[,6:ncol(df9)], df10[,6:ncol(df10)], df11[,6:ncol(df11)], df12[,6:ncol(df12)], df13[,6:ncol(df13)], df14[,6:ncol(df14)], df15[,6:ncol(df15)], df16[,6:ncol(df16)],  df17[,6:ncol(df17)],  df18[,6:ncol(df18), df18[,6:ncol(df18)])), col.names = T)
DFs <- na.omit(DFs)

write.table(DFs, file ="2015_Individuals_Canada.csv", sep = ",", row.names = FALSE, col.names = TRUE)
```

# Dimensionality reduction of tables per year


\newpage

```{r echo= FALSE}
library(knitr)
library(kableExtra)
Individuals <- data.frame(
  # = 1:19,	
  
  Table_ID = c("Table I-01", "Table I-02", "Table I-3A", "Table I-3B", "Table I-3C", "Table I-04", "Table I-5A", "Table I-5B",
            "Table I-5C", "Table I-06", "Table I-7A", "Table I-7B", "Table I-7C", "Table I-08", "Table I-09", "Table I-10",
            "Table I-11", "Table I-12", "Table I-13"), 
  
  Table_Name = c("Taxfilers and dependents, summary table, income and demographics of individuals", "Taxfilers and dependents by sex, marital status and age groups", "Male taxfilers and dependents by single years of age", "Female taxfilers and dependents by single years of age", "Taxfilers and dependents by single year of age", "Taxfilers and dependents with income by source of income", "Male taxfilers and dependents with income by total Income and age groups", "Female taxfilers and dependents with income by total income and age groups", "Taxfilers and dependents with income by total income and age groups", "Taxfilers and dependents with income by sex, income taxes, selected deductions and benefits", "Male taxfilers and dependents with income by after-tax income and age groups", "Female taxfilers and dependents  with income by after-tax income and age groups", "Taxfilers and dependents with income by after-tax income and age groups", "Taxfilers and dependents with income by income taxes and after-tax income, sex and age groups", "Economic dependency profile of individuals", "Labour income profile of individuals", "Taxfilers and dependents 15 years of age and over with labour income by sex and age groups", "Taxfilers and dependents 15 years of age and over receiving employment insurance by age groups and sex", "After-tax low income status of tax filers and dependents, census family low income measure, for couple and lone parent families by family composition"),																																																																											
 stringsAsFactors = FALSE)
``` 

```{r echo = FALSE}
kable(cbind(Individuals), "latex", booktabs = T, caption = "Structure for Individual Tables") %>%
  kable_styling(latex_options = c("striped", "scale_down", font_size=200))
```



```{r echo= FALSE}
library(knitr)
library(kableExtra)
Family <- data.frame(
  # = 1:26,	
  
  Table_ID = c("Table F-01", "Table F-02", "Table F-3A", "Table F-3B", "Table F-3C", "Table F-04A", "Table F-04B", "Table F-04C", "Table F-5A", "Table F-5B", "Table F-06", "Table F-7", "Table F-08", "Table F-09", "Table F-10", "Table F-11", "Table F-12", "Table F-13", "Table F-14A", "Table F-14B", "Table F-14C", "Table F-15", "Table F-17", "Table F-18", "Table F-19", "Table F-20"),
  
  Table_Name = c("Summary census family income table", "Taxfilers and dependents by age groups and census family type", "Couple families by age of older partner or parent and number of children", "Lone-Parent families by age of parent and number of children", "Census families by age of older partner or parent and number of children", "Distribution of total income by couple family and age of older partner or parent", "Distribution of total income by lone-parent family and age of parent", "Distribution of total income of persons not in census families by age of individual", "Couple families by total income and number of children", "Lone-Parent families by total income and number of children", "Sources of Income by census family Type", "Economic dependency profile of couple families", "Economic dependency profile of lone-parent families and persons not in census families", "Labour income profile of couple families", "Labour income profile of lone-parent families and persons not in census families", "Labour income by age group and sex", "Employment insurance by age group and sex", "Single-earner and dual-earner families by number of children, includes only partners, parents reporting non-negative employment income", "Couple families by percentage of wife's contribution to couple's employment income and by number of children", "Couple families by percentage of wife's contribution to husband/wife employment income and by age of wife", "Couple families by percentage of wife's contribution to husband, wife employment income and by family employment income range", "Census families with children by age of children and children by age groups", "Before-tax low income status, based on census family low income measures, family type and family composition", "After-tax low income status, based on census family low income measures, by family type and family composition", "After-tax low income status of census families, census family low income measures, by family type and family composition, adjusted methodology", "Census families by family type and family composition including before and after-tax median income of the family"),
  
  
 stringsAsFactors = FALSE)
``` 


```{r echo = FALSE}
kable(cbind(Family), "latex", booktabs = T, caption = "Structure for Family Tables") %>%
  kable_styling(latex_options = c("striped", "scale_down", font_size=200))
```
